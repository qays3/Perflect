<!DOCTYPE html>
<html :class="{ 'theme-dark': dark }" x-data="data()" lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ title }}</title>
  <link rel="icon" type="image/png" href="/static/img/Perflect.png">
  <link rel="apple-touch-icon" sizes="57x57" href="/static/img/Perflect.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/static/img/Perflect.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/static/img/Perflect.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/static/img/Perflect.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/static/img/Perflect.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/static/img/Perflect.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/static/img/Perflect.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/static/img/Perflect.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/img/Perflect.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/static/css/tailwind.output.css" />

  <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
  <script src="/static/js/init-alpine.js"></script>

  <link href="https://cdn.materialdesignicons.com/5.4.55/css/materialdesignicons.min.css" rel="stylesheet">

  <link rel="stylesheet" href="/static/css/main.css" />
  <link rel="stylesheet" href="/static/css/scroll.css" />
  <script src="/static/js/script.js"></script>

</head>

<body>
  <div class="flex h-screen bg-gray-50 dark:bg-gray-900" :class="{ 'overflow-hidden': isSideMenuOpen}">

    {% include 'includes/sidebar.html' %}

    <div class="flex flex-col flex-1">
      {% include 'includes/header.html' %}
      <main class="h-full pb-16 overflow-y-auto">
        <div class="container px-6 mx-auto">
          <h2 class="text-2xl font-semibold text-center my-6" :class="{'text-white': dark, 'text-black': !dark}">
            Port Management
          </h2>
      
          <div class="flex items-center space-x-4 mb-6">
            <input type="number" placeholder="Enter Port Number"
                   class="w-1/3 p-2 border rounded-md dark:bg-gray-800 dark:text-white text-gray-800"
                   id="portNumber" min="1" step="1" oninput="this.value=this.value.replace(/[^0-9]/g,'');">
            <button onclick="handlePort('open')" class="px-4 py-2 font-semibold text-white rounded-md" style="background-color: #191c24;">
              Open Port
            </button>
            <button onclick="handlePort('close')" class="px-4 py-2 font-semibold text-white rounded-md" style="background-color: #8743ff;">
              Close Port
            </button>
          </div>
      
          <div class="table-container">
            <table class="w-full text-sm text-left table-auto dark:bg-gray-800">
              <thead>
                <tr class="border-b dark:border-gray-700 text-gray-800 dark:text-gray-300">
                  <th class="px-4 py-2">Port</th>
                  <th class="px-4 py-2">Service</th>
                  <th class="px-4 py-2">Protocol</th>
                  <th class="px-4 py-2">PID</th>
                </tr>
              </thead>
              <tbody id="portsTableBody">
                {% for port in data %}
                  <tr class="border-b dark:border-gray-700 text-gray-800 dark:text-gray-300">
                    <td class="px-4 py-2">{{ port.port }}</td>
                    <td class="px-4 py-2">{{ port.service }}</td>
                    <td class="px-4 py-2">{{ port.protocol }}</td>
                    <td class="px-4 py-2">{{ port.pid }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </main>
      

      
      
    </div>
  </div>

 

  
    
    
    </div>
  </div>
  <script>
    function handlePort(action) {
        const port = document.getElementById("portNumber").value;
    
        if (!port) {
            alert("Please enter a port number.");
            return;
        }
    
        const url = action === "open" ? "/ports/open" : "/ports/close";
    
        fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ port: parseInt(port, 10) })
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(data => {
                    alert("Error: " + (data.detail || "Unknown error"));
                });
            }
            return response.json();
        })
        .then(data => {
            if (data && data.status) {
                alert(data.status);
    
                const tableBody = document.getElementById("portsTableBody");
                tableBody.innerHTML = '';
                data.ports.forEach(port => {
                    const row = document.createElement("tr");
                    row.classList.add("border-b", "dark:border-gray-700", "text-gray-800", "dark:text-gray-300");
                    row.innerHTML = `
                        <td class="px-4 py-2">${port.port}</td>
                        <td class="px-4 py-2">${port.service}</td>
                        <td class="px-4 py-2">${port.protocol}</td>
                        <td class="px-4 py-2">${port.pid}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        })
        .catch(error => {
            alert("Network error: " + error);
        });
    }
    </script>
    


</body>

</html>